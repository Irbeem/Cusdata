<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>üìÑ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏≠‡πà‡∏≤‡∏ô Google Sheet</title>
</head>
<body>
  <h2>üìÑ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏≠‡πà‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Google Sheets</h2>
  <div id="output">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div>

  <script>
    const SHEET_ID = '1ySiuPMVyrNOpNxx5fR0olf2Dbaq84zKVlVaVo6mFBi8';
    const SHEET_NAME = 'Carlendar';
    const endpoint = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?sheet=${SHEET_NAME}&tqx=out:json`;

    fetch(endpoint)
      .then(res => res.text())
      .then(text => {
        const json = JSON.parse(text.substring(47).slice(0, -2));
        const cols = json.table.cols.map(c => c.label);
        const rows = json.table.rows.map(r => {
          const obj = {};
          r.c.forEach((cell, i) => {
            const key = cols[i];
            if (key === "date" && cell && typeof cell.v === "string" && cell.v.includes("Date(")) {
              const match = cell.v.match(/Date\((\d+),(\d+),(\d+)\)/);
              if (match) {
                const [_, y, m, d] = match;
                obj[key] = new Date(Number(y), Number(m), Number(d)).toLocaleDateString("th-TH", {
                  year: 'numeric', month: '2-digit', day: '2-digit'
                });
              } else {
                obj[key] = cell.v;
              }
            } else {
              obj[key] = cell ? cell.v : "";
            }
          });
          return obj;
        });

        let html = `<table border="1" cellpadding="5"><tr>`;
        cols.forEach(col => html += `<th>${col}</th>`);
        html += `</tr>`;
        rows.forEach(row => {
          html += `<tr>`;
          cols.forEach(col => html += `<td>${row[col]}</td>`);
          html += `</tr>`;
        });
        html += `</table>`;

        document.getElementById("output").innerHTML = html;
      })
      .catch(err => {
        document.getElementById("output").innerHTML = `<p style="color:red;">‚ùå ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ${err.message}</p>`;
      });
  </script>
</body>
</html>
