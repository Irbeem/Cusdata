<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>CS Calendar</title>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <style>
    :root {
      --cal-scale: 1;
      --cell-w: 120px;
      --cell-h: 80px;
      --base-font: 16px;
      --bg: #f5f7fb;
      --text: #222;
      --panel-bg: #fff;
      --panel-border: #ddd;
      --btn-bg: #1976d2;
      --btn-text: #fff;
    }

    [data-theme="dark"] {
      --bg: #121212;
      --text: #eee;
      --panel-bg: #1e1e1e;
      --panel-border: #333;
      --btn-bg: #333;
      --btn-text: #fff;
    }

    body {
      margin: 0;
      font-family: "Segoe UI", sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    header {
      background: var(--panel-bg);
      border-bottom: 1px solid var(--panel-border);
      padding: 16px 20px;
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      position: sticky;
      top: 0;
      z-index: 100;
    }

    header h1 {
      margin: 0;
      font-size: 28px;
      font-weight: 700;
    }

    .nav-links a, header button {
      background: var(--btn-bg);
      color: var(--btn-text);
      border: none;
      border-radius: 6px;
      padding: 8px 14px;
      font-size: 16px;
      font-weight: 600;
      text-decoration: none;
      cursor: pointer;
      transition: 0.2s;
    }
    .nav-links a:hover, header button:hover {
      opacity: 0.9;
    }

    .controls {
      display: flex;
      align-items: center;
      flex-wrap: wrap;
      gap: 12px;
      margin-top: 8px;
    }

    .controls label, .controls select, .controls input, .controls button {
      font-size: 18px;
    }

    .calendar-wrapper {
      flex: 1;
      overflow: auto;
      background: var(--panel-bg);
      margin: 12px;
      border: 1px solid var(--panel-border);
      border-radius: 8px;
      padding: 8px;
    }

    #calendar-table {
      border-collapse: collapse;
      width: max-content;
    }

    #calendar-table th,
    #calendar-table td {
      width: calc(var(--cell-w) * var(--cal-scale));
      height: calc(var(--cell-h) * var(--cal-scale));
      border: 1px solid #ccc;
      padding: 6px;
      vertical-align: top;
      text-align: left;
      font-size: calc(var(--base-font) * 0.85);
      background: #fff;
      cursor: pointer;
    }

    #calendar-table thead th {
      position: sticky;
      top: 0;
      background: var(--panel-bg);
      z-index: 5;
      text-align: center;
    }

    #calendar-table th:first-child,
    #calendar-table td:first-child {
      position: sticky;
      left: 0;
      background: #f1f1f1;
      z-index: 6;
      font-weight: bold;
    }
    #calendar-table thead th:first-child { z-index: 7; }

    /* Events */
    #calendar-table .event {
      font-size: 0.85rem;
      padding: 4px 6px;
      display: block;
      border-radius: 4px;
      margin: 2px 0;
      overflow: hidden;
      text-overflow: ellipsis;
      word-break: break-word;
      border-left: 4px solid rgba(0,0,0,.15);
    }
    #calendar-table .Service   { background:#2a36b1; color:#fff; }
    #calendar-table .Standby   { background:#009688; color:#fff; }
    #calendar-table .Inspection{ background:#00bcd4; color:black; }
    #calendar-table .TrainingSafety{ background:#259b24; color:#fff; }
    #calendar-table .Training,
    #calendar-table .TrainingCustomer{ background:#cddc39; color:#000; }
    #calendar-table .TrainingInternal{ background:#ffc107; color:#000; }
    #calendar-table .Warranty  { background:#72d572; }
    #calendar-table .RepairPP  { background:#0277bd; color:#fff; }
    #calendar-table .Repair    { background:#311b92; color:#fff; }
    #calendar-table .Sales     { background:#78909c; color:#fff; }
    #calendar-table .Visit     { background:#f9d4b4; color:#000; }
    #calendar-table .Holiday,
    #calendar-table .Leave,
    #calendar-table .SafetyHealth{ background:#c41411; color:#fff; }
    #calendar-table .Other     { background:#fff176; color:#000; }

    /* Overlay & modal */
    .overlay { display:none; position:fixed; inset:0; background:rgba(0,0,0,.4); z-index:998; }
    .overlay.active { display:block; }
    .modal {
      display:none;
      position:fixed;
      top:50%; left:50%;
      transform:translate(-50%,-50%);
      background:var(--panel-bg);
      border:1px solid var(--panel-border);
      border-radius:8px;
      padding:20px;
      z-index:999;
      width:320px;
      max-height:80vh;
      overflow-y:auto;
    }
    .modal.active { display:block; }
    .modal h3 { margin:0 0 12px; text-align:center; }
    .modal button { padding:8px 14px; border:none; border-radius:6px; margin-right:6px; cursor:pointer; }
    .btn-save { background:#4CAF50; color:#fff; }
    .btn-del { background:#f44336; color:#fff; }
    .btn-cancel { background:#bbb; }

    /* Theme toggle button */
    #themeToggle {
      background: var(--btn-bg);
      color: var(--btn-text);
    }
  </style>
</head>
<body>
  <header>
    <h1>üìÖ CS BKK Calendar</h1>
    <div class="nav-links">
      <a href="index.html">üè† Home</a>
      <a href="bkkcalendarreport.html" target="_blank">üìä Report</a>
      <a href="bkklog.html">üìù Log</a>
      <a href="bkkbooking.html">üóìÔ∏è Booking</a>
      <a href="bkkmultidelete.html">üóëÔ∏è Delete</a>
      <a href="cbicalendar.html">üîÑ CBI</a>
      <button onclick="exportMonthToCSV()">üì§ Export CSV</button>
      <button id="themeToggle">üåô Dark</button>
    </div>
  </header>

  <div class="controls">
    <label>Month: <select id="month" onchange="renderTable()"></select></label>
    <label>Year: <select id="year" onchange="renderTable()"></select></label>
    <button onclick="gotoPrevMonth()">¬´ Prev</button>
    <button onclick="gotoThisMonth()">This Month</button>
    <button onclick="gotoNextMonth()">Next ¬ª</button>
    <input id="gotoDayInput" type="number" min="1" max="31" style="font-size:18px;width:80px;padding:4px;" placeholder="15">
    <button onclick="gotoDay()">Go</button>
    <button onclick="zoomOut()">‚àí Zoom out</button>
    <button onclick="zoomReset()">Normal</button>
    <button onclick="zoomIn()">+ Zoom in</button>
  </div>

  <div class="calendar-wrapper">
    <table id="calendar-table">
      <thead></thead>
      <tbody></tbody>
    </table>
  </div>

  <iframe name="hidden_frame" id="hidden_frame" style="display:none;"></iframe>
  <form id="submitForm" action="https://script.google.com/macros/s/AKfycbzr7NVLwYbYDQfaF6Y5SWWwlpKKLnIp_KZUQ8NF9_gXUj7R3tmSEum7yS_Z_A5y23Wi/exec" method="POST" target="hidden_frame">
    <input type="hidden" name="year">
    <input type="hidden" name="month">
    <input type="hidden" name="date">
    <input type="hidden" name="name">
    <input type="hidden" name="type">
    <input type="hidden" name="time">
    <input type="hidden" name="datail">
    <input type="hidden" name="customer">
    <input type="hidden" name="place">
    <input type="hidden" name="jobowner">
    <input type="hidden" name="charge">
    <input type="hidden" name="action">
    <input type="hidden" name="holidayDetail">
    <input type="hidden" name="sendEmail">
    <input type="hidden" id="actorName" name="actorName">
  </form>

  <div class="overlay" id="overlay"></div>
  <div class="modal" id="popupForm">
    <h3>Booking</h3>
    <div>Name: <span id="popupName"></span></div>
    <div>Date: <span id="popupDate"></span></div>
    <label>Job Type:<select id="popupType"></select></label><br>
    <label>Customer: <input type="text" id="popupCustomer"></label><br>
    <label>Time: <input type="text" id="popupTime"></label><br>
    <label>Detail: <input type="text" id="popupDetail"></label><br>
    <label>Place: <input type="text" id="popupPlace"></label><br>
    <label>Owner: <input type="text" id="popupJobowner"></label><br>
    <label>Charge:<select id="popupCharge"></select></label><br>
    <label><input type="checkbox" id="popupSendEmail"> Send e-mail</label><br>
    <button type="button" onclick="saveData()" class="btn-save">Save</button>
    <button type="button" onclick="deleteData()" class="btn-del">Delete</button>
    <button type="button" onclick="closePopup()" class="btn-cancel">Cancel</button>
  </div>

  <div id="summaryDock"></div>

  <!-- ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå‡∏à‡∏£‡∏¥‡∏á -->
  <script src="config.js" defer></script>
  <script type="module" src="calscriptnew.js"></script>

  <!-- Theme toggle -->
  <script>
    const THEME_KEY = 'cs-calendar-theme';
    const btn = document.getElementById('themeToggle');
    function applyTheme(theme) {
      if (theme === 'dark') {
        document.documentElement.setAttribute('data-theme','dark');
        btn.textContent = '‚òÄÔ∏è Light';
      } else {
        document.documentElement.removeAttribute('data-theme');
        btn.textContent = 'üåô Dark';
      }
    }
    (function initTheme(){
      const saved = localStorage.getItem(THEME_KEY);
      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      const theme = saved || (prefersDark ? 'dark':'light');
      applyTheme(theme);
    })();
    btn.addEventListener('click', ()=>{
      const isDark = document.documentElement.getAttribute('data-theme')==='dark';
      const next = isDark?'light':'dark';
      localStorage.setItem(THEME_KEY,next);
      applyTheme(next);
    });
  </script>
</body>
</html>
