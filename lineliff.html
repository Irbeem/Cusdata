<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>CS Calendar - LIFF Popup</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <style>
    body { font-family: sans-serif; padding: 1rem; }
    label { display: block; margin-top: 10px; }
    input, select { width: 100%; padding: 8px; margin-top: 4px; }
    button { margin-top: 12px; padding: 10px 20px; background: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer; }
    button:hover { background: #45a049; }
  </style>
</head>
<body>
  <h2>üìÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏á‡∏≤‡∏ô</h2>
  <form id="saveForm">
    <label>‡∏ä‡∏∑‡πà‡∏≠:
      <select name="name" id="nameDropdown" required>
        <option value="">-- ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î --</option>
      </select>
    </label>
    <label>‡∏õ‡∏µ: <input type="number" name="year" required value="2025"></label>
    <label>‡πÄ‡∏î‡∏∑‡∏≠‡∏ô: <input type="number" name="month" required value="7"></label>
    <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: <input type="number" name="date" required value="1"></label>
    <label>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏á‡∏≤‡∏ô:
      <select name="type">
        <option value="Service">Service</option>
        <option value="Meeting">Meeting</option>
        <option value="Inspection">Inspection</option>
        <option value="Training">Training</option>
        <option value="Warranty">Warranty</option>
        <option value="Sales">Sales</option>
        <option value="Leave">Leave</option>
        <option value="SafetyHealth">SafetyHealth</option>
        <option value="Oth">Oth</option>
      </select>
    </label>
    <label>‡πÄ‡∏ß‡∏•‡∏≤: <input type="text" name="time"></label>
    <label>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î: <input type="text" name="datail"></label>
    <label>‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤: <input type="text" name="customer"></label>
    <label>‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà: <input type="text" name="place"></label>
    <label>‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö: <input type="text" name="jobowner"></label>
    <label>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢:
      <select name="charge">
        <option value="Charge">Charge</option>
        <option value="Nocharge">Nocharge</option>
        <option value="Warranty">Warranty</option>
        <option value="Sales">Sales</option>
        <option value="Oth">Oth</option>
      </select>
    </label>
    <input type="hidden" name="action" value="save">
    <button type="submit">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
  </form>

  <div id="result"></div>

  <script>
    const GOOGLE_SHEET_NAMES_URL = 'https://script.google.com/macros/s/AKfycbzr7NVLwYbYDQfaF6Y5SWWwlpKKLnIp_KZUQ8NF9_gXUj7R3tmSEum7yS_Z_A5y23Wi/exec'; 
    const SUBMIT_URL = 'https://script.google.com/macros/s/AKfycbzr7NVLwYbYDQfaF6Y5SWWwlpKKLnIp_KZUQ8NF9_gXUj7R3tmSEum7yS_Z_A5y23Wi/exec'; 

    async function loadNames() {
      try {
        const res = await fetch(GOOGLE_SHEET_NAMES_URL);
        const names = await res.json();
        const dropdown = document.getElementById('nameDropdown');
        dropdown.innerHTML = names.map(n => `<option value="${n}">${n}</option>`).join('');
      } catch (err) {
        console.error("Error loading names:", err);
        alert("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏î‡πâ");
      }
    }

    document.getElementById('saveForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      const form = new FormData(this);
      try {
        const res = await fetch(SUBMIT_URL, {
          method: 'POST',
          body: form
        });
        const text = await res.text();
        document.getElementById("result").textContent = "‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: " + text;
        if (liff && liff.closeWindow) liff.closeWindow();
      } catch (err) {
       // document.getElementById("result").textContent = "‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + err;
      }
    });

    // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÇ‡∏´‡∏•‡∏î
    loadNames();
  </script>
</body>
</html>
